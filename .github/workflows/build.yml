name: Build Dylib

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Theos Setup
        uses: Randomblock1/theos-action@v1
      
      - name: Build
        run: |
          # 1. 开始编译
          make package FINALPACKAGE=1
          
          # 2. 创建输出目录
          mkdir -p output
          
          # 3. 【关键修正】这里同时查找 obj 和 obj/debug 两个位置，保证能找到文件
          # 这里的 || true 是为了防止命令报错停止
          cp .theos/obj/*.dylib output/ 2>/dev/null || true
          cp .theos/obj/debug/*.dylib output/ 2>/dev/null || true
          
          # 4. 检查一下有没有成功复制出来
          ls -R output
          
      - name: Upload Dylib
        uses: actions/upload-artifact@v4
        with:
          name: MyHackedDylib
          path: output/*.dylib
